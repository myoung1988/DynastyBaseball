/*
Deployment script for Baseball

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "Baseball"
:setvar DefaultFilePrefix "Baseball"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Rename refactoring operation with key 5b991590-0865-49c9-95a8-c034b6ce26fe is skipped, element [SystemConfig].[RosterSettings].[CategoryID] (SqlSimpleColumn) will not be renamed to PositionID';


GO
PRINT N'Rename refactoring operation with key 3e29ad30-7a66-4f68-9fe6-389f71a47a2d is skipped, element [LeagueConfig].[Team_Roster_Positions].[PointValuePer] (SqlSimpleColumn) will not be renamed to MaximumStarters';


GO
PRINT N'Rename refactoring operation with key b6fe7736-ed0d-4412-b930-64d5fe77de5d is skipped, element [LeagueConfig].[Team_Roster_Positions].[UseScoringRanges] (SqlSimpleColumn) will not be renamed to MinimumRoster';


GO
PRINT N'Rename refactoring operation with key 082788fa-0d50-4f1a-b516-c40d2b8c23f1 is skipped, element [LeagueConfig].[Team_Roster_Positions].[UseScoringBonuses] (SqlSimpleColumn) will not be renamed to MaximumRoster';


GO
PRINT N'Rename refactoring operation with key cf6f3c10-eada-48e6-bbe7-938ee8102571, 5447d75f-b792-4723-a267-89d06f1f8cb0 is skipped, element [dbo].[Transaction].[Id] (SqlSimpleColumn) will not be renamed to FantasyLeagueID';


GO
PRINT N'Rename refactoring operation with key f1d4017e-af9d-4689-8016-32a1435a0a20, 43e65096-cbd4-4c8e-ac93-d628507d10da is skipped, element [dbo].[Transaction].[Commishinoer] (SqlSimpleColumn) will not be renamed to CommissionerPerformed';


GO
PRINT N'Rename refactoring operation with key 73091309-46ba-42ff-b239-5c1916e17514 is skipped, element [dbo].[Transaction].[Form_Id_Modified] (SqlSimpleColumn) will not be renamed to Form_Id_Modified_Modified';


GO
PRINT N'Rename refactoring operation with key 5d9ea605-350c-4111-ad30-3f5b8bc000be, 962b0297-5a65-4b2d-ad7a-01ef47097cb7 is skipped, element [MLB].[Stats_Projection].[Day] (SqlSimpleColumn) will not be renamed to SeasonID';


GO
PRINT N'Rename refactoring operation with key a6e60334-468a-4e51-9eed-6965bdcb2d67 is skipped, element [dbo].[Schedule].[Id] (SqlSimpleColumn) will not be renamed to FantasyLeagueID';


GO
PRINT N'Rename refactoring operation with key 7ed5d9d3-218e-4aae-be61-d125e3c7eddb is skipped, element [dbo].[Schedule].[P] (SqlSimpleColumn) will not be renamed to PeriodStartDate';


GO
PRINT N'Rename refactoring operation with key c534cefd-85d6-4660-8d54-e7ed36746ad9 is skipped, element [dbo].[Season].[Id] (SqlSimpleColumn) will not be renamed to SeasonID';


GO
PRINT N'Rename refactoring operation with key 3834020f-4d23-450f-9c2b-ac2aeaa60c64 is skipped, element [MLB].[Eligibility].[Season] (SqlSimpleColumn) will not be renamed to SeasonID';


GO
PRINT N'Rename refactoring operation with key bf189aeb-3cda-426e-9a85-1fa0f60a4983 is skipped, element [MLB].[Stats_Season].[Season] (SqlSimpleColumn) will not be renamed to SeasonID';


GO
PRINT N'Dropping DF__Eligibili__Prima__349EBC9F...';


GO
ALTER TABLE [MLB].[Eligibility] DROP CONSTRAINT [DF__Eligibili__Prima__349EBC9F];


GO
PRINT N'Dropping DF__Eligibili__DaysP__3592E0D8...';


GO
ALTER TABLE [MLB].[Eligibility] DROP CONSTRAINT [DF__Eligibili__DaysP__3592E0D8];


GO
PRINT N'Dropping DF__Eligibili__Date___5B4E756C...';


GO
ALTER TABLE [MLB].[Eligibility] DROP CONSTRAINT [DF__Eligibili__Date___5B4E756C];


GO
PRINT N'Dropping DF__Eligibili__Date___5C4299A5...';


GO
ALTER TABLE [MLB].[Eligibility] DROP CONSTRAINT [DF__Eligibili__Date___5C4299A5];


GO
PRINT N'Dropping DF__League__Date_Tim__455F344D...';


GO
ALTER TABLE [Fantasy].[League] DROP CONSTRAINT [DF__League__Date_Tim__455F344D];


GO
PRINT N'Dropping DF__League__Date_Tim__46535886...';


GO
ALTER TABLE [Fantasy].[League] DROP CONSTRAINT [DF__League__Date_Tim__46535886];


GO
PRINT N'Dropping DF__Roster__Date_Tim__47477CBF...';


GO
ALTER TABLE [Fantasy].[Roster] DROP CONSTRAINT [DF__Roster__Date_Tim__47477CBF];


GO
PRINT N'Dropping DF__Roster__Date_Tim__483BA0F8...';


GO
ALTER TABLE [Fantasy].[Roster] DROP CONSTRAINT [DF__Roster__Date_Tim__483BA0F8];


GO
PRINT N'Dropping DF__Team__Date_Time___492FC531...';


GO
ALTER TABLE [Fantasy].[Team] DROP CONSTRAINT [DF__Team__Date_Time___492FC531];


GO
PRINT N'Dropping DF__Team__Date_Time___4A23E96A...';


GO
ALTER TABLE [Fantasy].[Team] DROP CONSTRAINT [DF__Team__Date_Time___4A23E96A];


GO
PRINT N'Dropping DF__Transacti__Trans__4B180DA3...';


GO
ALTER TABLE [Fantasy].[Transaction] DROP CONSTRAINT [DF__Transacti__Trans__4B180DA3];


GO
PRINT N'Dropping DF__Transacti__Date___4C0C31DC...';


GO
ALTER TABLE [Fantasy].[Transaction] DROP CONSTRAINT [DF__Transacti__Date___4C0C31DC];


GO
PRINT N'Dropping DF__Transacti__Date___4D005615...';


GO
ALTER TABLE [Fantasy].[Transaction] DROP CONSTRAINT [DF__Transacti__Date___4D005615];


GO
PRINT N'Dropping DF__Config__Date_Tim__4DF47A4E...';


GO
ALTER TABLE [LeagueConfig].[Config] DROP CONSTRAINT [DF__Config__Date_Tim__4DF47A4E];


GO
PRINT N'Dropping DF__Config__Date_Tim__4EE89E87...';


GO
ALTER TABLE [LeagueConfig].[Config] DROP CONSTRAINT [DF__Config__Date_Tim__4EE89E87];


GO
PRINT N'Dropping DF__Scoring_S__Date___4FDCC2C0...';


GO
ALTER TABLE [LeagueConfig].[Scoring_System_Category] DROP CONSTRAINT [DF__Scoring_S__Date___4FDCC2C0];


GO
PRINT N'Dropping DF__Scoring_S__Date___50D0E6F9...';


GO
ALTER TABLE [LeagueConfig].[Scoring_System_Category] DROP CONSTRAINT [DF__Scoring_S__Date___50D0E6F9];


GO
PRINT N'Dropping DF__Scoring_S__Date___51C50B32...';


GO
ALTER TABLE [LeagueConfig].[Scoring_System_Category_PointBonuses] DROP CONSTRAINT [DF__Scoring_S__Date___51C50B32];


GO
PRINT N'Dropping DF__Scoring_S__Date___52B92F6B...';


GO
ALTER TABLE [LeagueConfig].[Scoring_System_Category_PointBonuses] DROP CONSTRAINT [DF__Scoring_S__Date___52B92F6B];


GO
PRINT N'Dropping DF__Scoring_S__Date___53AD53A4...';


GO
ALTER TABLE [LeagueConfig].[Scoring_System_Category_PointRange] DROP CONSTRAINT [DF__Scoring_S__Date___53AD53A4];


GO
PRINT N'Dropping DF__Scoring_S__Date___54A177DD...';


GO
ALTER TABLE [LeagueConfig].[Scoring_System_Category_PointRange] DROP CONSTRAINT [DF__Scoring_S__Date___54A177DD];


GO
PRINT N'Dropping DF__Team_Rost__Date___55959C16...';


GO
ALTER TABLE [LeagueConfig].[Team_Roster_Limits] DROP CONSTRAINT [DF__Team_Rost__Date___55959C16];


GO
PRINT N'Dropping DF__Team_Rost__Date___5689C04F...';


GO
ALTER TABLE [LeagueConfig].[Team_Roster_Limits] DROP CONSTRAINT [DF__Team_Rost__Date___5689C04F];


GO
PRINT N'Dropping DF__Team_Rost__Date___577DE488...';


GO
ALTER TABLE [LeagueConfig].[Team_Roster_Positions] DROP CONSTRAINT [DF__Team_Rost__Date___577DE488];


GO
PRINT N'Dropping DF__Team_Rost__Date___587208C1...';


GO
ALTER TABLE [LeagueConfig].[Team_Roster_Positions] DROP CONSTRAINT [DF__Team_Rost__Date___587208C1];


GO
PRINT N'Dropping DF__Transacti__Date___59662CFA...';


GO
ALTER TABLE [LeagueConfig].[Transaction_Policies] DROP CONSTRAINT [DF__Transacti__Date___59662CFA];


GO
PRINT N'Dropping DF__Transacti__Date___5A5A5133...';


GO
ALTER TABLE [LeagueConfig].[Transaction_Policies] DROP CONSTRAINT [DF__Transacti__Date___5A5A5133];


GO
PRINT N'Dropping DF__Player__Date_Tim__5D36BDDE...';


GO
ALTER TABLE [MLB].[Player] DROP CONSTRAINT [DF__Player__Date_Tim__5D36BDDE];


GO
PRINT N'Dropping DF__Player__Date_Tim__5E2AE217...';


GO
ALTER TABLE [MLB].[Player] DROP CONSTRAINT [DF__Player__Date_Tim__5E2AE217];


GO
PRINT N'Dropping DF__Position__Date_T__5F1F0650...';


GO
ALTER TABLE [MLB].[Position] DROP CONSTRAINT [DF__Position__Date_T__5F1F0650];


GO
PRINT N'Dropping DF__Position__Date_T__60132A89...';


GO
ALTER TABLE [MLB].[Position] DROP CONSTRAINT [DF__Position__Date_T__60132A89];


GO
PRINT N'Dropping DF__Stats_Dai__Date___61074EC2...';


GO
ALTER TABLE [MLB].[Stats_Daily] DROP CONSTRAINT [DF__Stats_Dai__Date___61074EC2];


GO
PRINT N'Dropping DF__Stats_Dai__Date___61FB72FB...';


GO
ALTER TABLE [MLB].[Stats_Daily] DROP CONSTRAINT [DF__Stats_Dai__Date___61FB72FB];


GO
PRINT N'Dropping DF__Stats_Pro__Date___62EF9734...';


GO
ALTER TABLE [MLB].[Stats_Projection] DROP CONSTRAINT [DF__Stats_Pro__Date___62EF9734];


GO
PRINT N'Dropping DF__Stats_Pro__Date___63E3BB6D...';


GO
ALTER TABLE [MLB].[Stats_Projection] DROP CONSTRAINT [DF__Stats_Pro__Date___63E3BB6D];


GO
PRINT N'Dropping DF__Stats_Sea__Date___64D7DFA6...';


GO
ALTER TABLE [MLB].[Stats_Season] DROP CONSTRAINT [DF__Stats_Sea__Date___64D7DFA6];


GO
PRINT N'Dropping DF__Stats_Sea__Date___65CC03DF...';


GO
ALTER TABLE [MLB].[Stats_Season] DROP CONSTRAINT [DF__Stats_Sea__Date___65CC03DF];


GO
PRINT N'Dropping DF__Team__Date_Time___66C02818...';


GO
ALTER TABLE [MLB].[Team] DROP CONSTRAINT [DF__Team__Date_Time___66C02818];


GO
PRINT N'Dropping DF__Team__Date_Time___67B44C51...';


GO
ALTER TABLE [MLB].[Team] DROP CONSTRAINT [DF__Team__Date_Time___67B44C51];


GO
PRINT N'Dropping DF__RosterPos__Date___68A8708A...';


GO
ALTER TABLE [SystemConfig].[RosterPositions] DROP CONSTRAINT [DF__RosterPos__Date___68A8708A];


GO
PRINT N'Dropping DF__RosterPos__Date___699C94C3...';


GO
ALTER TABLE [SystemConfig].[RosterPositions] DROP CONSTRAINT [DF__RosterPos__Date___699C94C3];


GO
PRINT N'Dropping DF__ScoringCa__Date___6A90B8FC...';


GO
ALTER TABLE [SystemConfig].[ScoringCategories] DROP CONSTRAINT [DF__ScoringCa__Date___6A90B8FC];


GO
PRINT N'Dropping DF__ScoringCa__Date___6B84DD35...';


GO
ALTER TABLE [SystemConfig].[ScoringCategories] DROP CONSTRAINT [DF__ScoringCa__Date___6B84DD35];


GO
PRINT N'Dropping FK_Eligilblity_Posiition...';


GO
ALTER TABLE [MLB].[Eligibility] DROP CONSTRAINT [FK_Eligilblity_Posiition];


GO
PRINT N'Starting rebuilding table [MLB].[Eligibility]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [MLB].[tmp_ms_xx_Eligibility] (
    [PlayerID]           INT          NOT NULL,
    [SeasonID]           INT          NOT NULL,
    [PositionID]         INT          NOT NULL,
    [PrimaryPos]         BIT          DEFAULT 1 NOT NULL,
    [DaysPlayed]         INT          DEFAULT 0 NOT NULL,
    [Date_Time_Created]  DATETIME     DEFAULT CURRENT_TIMESTAMP NOT NULL,
    [User_Id_Created]    VARCHAR (50) NULL,
    [Date_Time_Modified] DATETIME     DEFAULT CURRENT_TIMESTAMP NOT NULL,
    [User_Id_Modified]   VARCHAR (50) NULL,
    [Form_Id_Modified]   VARCHAR (50) NULL,
    PRIMARY KEY CLUSTERED ([PlayerID] ASC, [SeasonID] ASC, [PositionID] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [MLB].[Eligibility])
    BEGIN
        INSERT INTO [MLB].[tmp_ms_xx_Eligibility] ([PlayerID], [SeasonID], [PositionID], [PrimaryPos], [DaysPlayed], [Date_Time_Created], [User_Id_Created], [Date_Time_Modified], [User_Id_Modified], [Form_Id_Modified])
        SELECT   [PlayerID],
                 [SeasonID],
                 [PositionID],
                 [PrimaryPos],
                 [DaysPlayed],
                 [Date_Time_Created],
                 [User_Id_Created],
                 [Date_Time_Modified],
                 [User_Id_Modified],
                 [Form_Id_Modified]
        FROM     [MLB].[Eligibility]
        ORDER BY [PlayerID] ASC, [SeasonID] ASC, [PositionID] ASC;
    END

DROP TABLE [MLB].[Eligibility];

EXECUTE sp_rename N'[MLB].[tmp_ms_xx_Eligibility]', N'Eligibility';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating Default Constraint on [Fantasy].[League]....';


GO
ALTER TABLE [Fantasy].[League]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Created];


GO
PRINT N'Creating Default Constraint on [Fantasy].[League]....';


GO
ALTER TABLE [Fantasy].[League]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Modified];


GO
PRINT N'Creating Default Constraint on [Fantasy].[Roster]....';


GO
ALTER TABLE [Fantasy].[Roster]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Created];


GO
PRINT N'Creating Default Constraint on [Fantasy].[Roster]....';


GO
ALTER TABLE [Fantasy].[Roster]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Modified];


GO
PRINT N'Creating Default Constraint on [Fantasy].[Team]....';


GO
ALTER TABLE [Fantasy].[Team]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Created];


GO
PRINT N'Creating Default Constraint on [Fantasy].[Team]....';


GO
ALTER TABLE [Fantasy].[Team]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Modified];


GO
PRINT N'Creating Default Constraint on [Fantasy].[Transaction]....';


GO
ALTER TABLE [Fantasy].[Transaction]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [TransactionDate];


GO
PRINT N'Creating Default Constraint on [Fantasy].[Transaction]....';


GO
ALTER TABLE [Fantasy].[Transaction]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Created];


GO
PRINT N'Creating Default Constraint on [Fantasy].[Transaction]....';


GO
ALTER TABLE [Fantasy].[Transaction]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Modified];


GO
PRINT N'Creating Default Constraint on [LeagueConfig].[Config]....';


GO
ALTER TABLE [LeagueConfig].[Config]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Created];


GO
PRINT N'Creating Default Constraint on [LeagueConfig].[Config]....';


GO
ALTER TABLE [LeagueConfig].[Config]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Modified];


GO
PRINT N'Creating Default Constraint on [LeagueConfig].[Scoring_System_Category]....';


GO
ALTER TABLE [LeagueConfig].[Scoring_System_Category]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Created];


GO
PRINT N'Creating Default Constraint on [LeagueConfig].[Scoring_System_Category]....';


GO
ALTER TABLE [LeagueConfig].[Scoring_System_Category]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Modified];


GO
PRINT N'Creating Default Constraint on [LeagueConfig].[Scoring_System_Category_PointBonuses]....';


GO
ALTER TABLE [LeagueConfig].[Scoring_System_Category_PointBonuses]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Created];


GO
PRINT N'Creating Default Constraint on [LeagueConfig].[Scoring_System_Category_PointBonuses]....';


GO
ALTER TABLE [LeagueConfig].[Scoring_System_Category_PointBonuses]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Modified];


GO
PRINT N'Creating Default Constraint on [LeagueConfig].[Scoring_System_Category_PointRange]....';


GO
ALTER TABLE [LeagueConfig].[Scoring_System_Category_PointRange]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Created];


GO
PRINT N'Creating Default Constraint on [LeagueConfig].[Scoring_System_Category_PointRange]....';


GO
ALTER TABLE [LeagueConfig].[Scoring_System_Category_PointRange]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Modified];


GO
PRINT N'Creating Default Constraint on [LeagueConfig].[Team_Roster_Limits]....';


GO
ALTER TABLE [LeagueConfig].[Team_Roster_Limits]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Created];


GO
PRINT N'Creating Default Constraint on [LeagueConfig].[Team_Roster_Limits]....';


GO
ALTER TABLE [LeagueConfig].[Team_Roster_Limits]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Modified];


GO
PRINT N'Creating Default Constraint on [LeagueConfig].[Team_Roster_Positions]....';


GO
ALTER TABLE [LeagueConfig].[Team_Roster_Positions]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Created];


GO
PRINT N'Creating Default Constraint on [LeagueConfig].[Team_Roster_Positions]....';


GO
ALTER TABLE [LeagueConfig].[Team_Roster_Positions]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Modified];


GO
PRINT N'Creating Default Constraint on [LeagueConfig].[Transaction_Policies]....';


GO
ALTER TABLE [LeagueConfig].[Transaction_Policies]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Created];


GO
PRINT N'Creating Default Constraint on [LeagueConfig].[Transaction_Policies]....';


GO
ALTER TABLE [LeagueConfig].[Transaction_Policies]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Modified];


GO
PRINT N'Creating Default Constraint on [MLB].[Player]....';


GO
ALTER TABLE [MLB].[Player]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Created];


GO
PRINT N'Creating Default Constraint on [MLB].[Player]....';


GO
ALTER TABLE [MLB].[Player]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Modified];


GO
PRINT N'Creating Default Constraint on [MLB].[Position]....';


GO
ALTER TABLE [MLB].[Position]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Created];


GO
PRINT N'Creating Default Constraint on [MLB].[Position]....';


GO
ALTER TABLE [MLB].[Position]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Modified];


GO
PRINT N'Creating Default Constraint on [MLB].[Stats_Daily]....';


GO
ALTER TABLE [MLB].[Stats_Daily]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Created];


GO
PRINT N'Creating Default Constraint on [MLB].[Stats_Daily]....';


GO
ALTER TABLE [MLB].[Stats_Daily]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Modified];


GO
PRINT N'Creating Default Constraint on [MLB].[Stats_Projection]....';


GO
ALTER TABLE [MLB].[Stats_Projection]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Created];


GO
PRINT N'Creating Default Constraint on [MLB].[Stats_Projection]....';


GO
ALTER TABLE [MLB].[Stats_Projection]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Modified];


GO
PRINT N'Creating Default Constraint on [MLB].[Stats_Season]....';


GO
ALTER TABLE [MLB].[Stats_Season]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Created];


GO
PRINT N'Creating Default Constraint on [MLB].[Stats_Season]....';


GO
ALTER TABLE [MLB].[Stats_Season]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Modified];


GO
PRINT N'Creating Default Constraint on [MLB].[Team]....';


GO
ALTER TABLE [MLB].[Team]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Created];


GO
PRINT N'Creating Default Constraint on [MLB].[Team]....';


GO
ALTER TABLE [MLB].[Team]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Modified];


GO
PRINT N'Creating Default Constraint on [SystemConfig].[RosterPositions]....';


GO
ALTER TABLE [SystemConfig].[RosterPositions]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Created];


GO
PRINT N'Creating Default Constraint on [SystemConfig].[RosterPositions]....';


GO
ALTER TABLE [SystemConfig].[RosterPositions]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Modified];


GO
PRINT N'Creating Default Constraint on [SystemConfig].[ScoringCategories]....';


GO
ALTER TABLE [SystemConfig].[ScoringCategories]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Created];


GO
PRINT N'Creating Default Constraint on [SystemConfig].[ScoringCategories]....';


GO
ALTER TABLE [SystemConfig].[ScoringCategories]
    ADD DEFAULT CURRENT_TIMESTAMP FOR [Date_Time_Modified];


GO
PRINT N'Creating FK_Eligilblity_Posiition...';


GO
ALTER TABLE [MLB].[Eligibility] WITH NOCHECK
    ADD CONSTRAINT [FK_Eligilblity_Posiition] FOREIGN KEY ([PositionID]) REFERENCES [MLB].[Position] ([PositionID]) ON DELETE CASCADE;


GO
PRINT N'Altering [dbo].[Testing_SetupBaseMLB]...';


GO
ALTER PROCEDURE [dbo].[Testing_SetupBaseMLB]

AS
BEGIN
-- Teams
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (1, 'ARI', 'Diamondbacks')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (2, 'ATL', 'Braves')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (3, 'BAL', 'Orioles')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (4, 'BOS', 'Red Sox')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (5, 'CHC', 'Cubs')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (6, 'CHW', 'White Sox')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (7, 'CIN', 'Reds')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (8, 'CLE', 'Indians')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (9, 'COL', 'Rockies')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (10, 'DET', 'Tigers')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (11, 'HOU', 'Astros')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (12, 'KC', 'Royals')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (13, 'LAA', 'Angels')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (14, 'LAD', 'Dodgers')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (15, 'MIA', 'Marlins')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (16, 'MIL', 'Brewers')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (17, 'MIN', 'Twins')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (18, 'NYM', 'Mets')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (19, 'NYY', 'Yankees')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (20, 'OAK', 'As')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (21, 'PHI', 'Phillies')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (22, 'PIT', 'Pirates')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (23, 'SD', 'Padres')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (24, 'SEA', 'Mariners')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (25, 'SF', 'Giants')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (26, 'STL', 'Cardinals')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (27, 'TB', 'Rays')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (28, 'TEX', 'Rangers')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (29, 'TOR', 'Blue Jays')
INSERT INTO MLB.Team (TeamID, Abbreviation, Name) VALUES (30, 'WAS', 'Nationals')

-- Positions
INSERT INTO MLB.Position (PositionID, Name) VALUES (1, 'C')
INSERT INTO MLB.Position (PositionID, Name) VALUES (2, '1B')
INSERT INTO MLB.Position (PositionID, Name) VALUES (3, '2B')
INSERT INTO MLB.Position (PositionID, Name) VALUES (4, '3B')
INSERT INTO MLB.Position (PositionID, Name) VALUES (5, 'SS')
INSERT INTO MLB.Position (PositionID, Name) VALUES (6, 'OF')
INSERT INTO MLB.Position (PositionID, Name) VALUES (7, 'U')
INSERT INTO MLB.Position (PositionID, Name) VALUES (8, 'SP')
INSERT INTO MLB.Position (PositionID, Name) VALUES (9, 'RP')
INSERT INTO MLB.Position (PositionID, Name) VALUES (10, 'P')
INSERT INTO MLB.Position (PositionID, Name) VALUES (11, 'MI')
INSERT INTO MLB.Position (PositionID, Name) VALUES (12, 'CI')
INSERT INTO MLB.Position (PositionID, Name) VALUES (13, 'LF')
INSERT INTO MLB.Position (PositionID, Name) VALUES (14, 'CF')
INSERT INTO MLB.Position (PositionID, Name) VALUES (15, 'RF')
INSERT INTO MLB.Position (PositionID, Name) VALUES (16, 'DH')


END
GO
PRINT N'Refreshing [dbo].[Testing_SetupEligibility]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[Testing_SetupEligibility]';


GO
-- Refactoring step to update target server with deployed transaction logs
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '5b991590-0865-49c9-95a8-c034b6ce26fe')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('5b991590-0865-49c9-95a8-c034b6ce26fe')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '3e29ad30-7a66-4f68-9fe6-389f71a47a2d')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('3e29ad30-7a66-4f68-9fe6-389f71a47a2d')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'b6fe7736-ed0d-4412-b930-64d5fe77de5d')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('b6fe7736-ed0d-4412-b930-64d5fe77de5d')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '082788fa-0d50-4f1a-b516-c40d2b8c23f1')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('082788fa-0d50-4f1a-b516-c40d2b8c23f1')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'cf6f3c10-eada-48e6-bbe7-938ee8102571')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('cf6f3c10-eada-48e6-bbe7-938ee8102571')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '5447d75f-b792-4723-a267-89d06f1f8cb0')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('5447d75f-b792-4723-a267-89d06f1f8cb0')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'f1d4017e-af9d-4689-8016-32a1435a0a20')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('f1d4017e-af9d-4689-8016-32a1435a0a20')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '43e65096-cbd4-4c8e-ac93-d628507d10da')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('43e65096-cbd4-4c8e-ac93-d628507d10da')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '73091309-46ba-42ff-b239-5c1916e17514')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('73091309-46ba-42ff-b239-5c1916e17514')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '5d9ea605-350c-4111-ad30-3f5b8bc000be')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('5d9ea605-350c-4111-ad30-3f5b8bc000be')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'a6e60334-468a-4e51-9eed-6965bdcb2d67')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('a6e60334-468a-4e51-9eed-6965bdcb2d67')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '7ed5d9d3-218e-4aae-be61-d125e3c7eddb')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('7ed5d9d3-218e-4aae-be61-d125e3c7eddb')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'c534cefd-85d6-4660-8d54-e7ed36746ad9')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('c534cefd-85d6-4660-8d54-e7ed36746ad9')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '3834020f-4d23-450f-9c2b-ac2aeaa60c64')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('3834020f-4d23-450f-9c2b-ac2aeaa60c64')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '962b0297-5a65-4b2d-ad7a-01ef47097cb7')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('962b0297-5a65-4b2d-ad7a-01ef47097cb7')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'bf189aeb-3cda-426e-9a85-1fa0f60a4983')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('bf189aeb-3cda-426e-9a85-1fa0f60a4983')

GO

GO
EXEC sp_MSForEachTable 'DISABLE TRIGGER ALL ON ?'
GO
EXEC sp_MSForEachTable 'ALTER TABLE ? NOCHECK CONSTRAINT ALL'
GO
EXEC sp_MSForEachTable 'DELETE FROM ?'
GO
EXEC sp_MSForEachTable 'ALTER TABLE ? CHECK CONSTRAINT ALL'
GO
EXEC sp_MSForEachTable 'ENABLE TRIGGER ALL ON ?'
GO

EXEC Testing_SetupSystemConfig
EXEC Testing_SetupBaseMLB
EXEC Testing_SetupLeagueConfig
EXEC Testing_SetupPlayer
EXEC Testing_SetupRoster
EXEC Testing_SetupSeasonStats 
EXEC Testing_SetupEligibility

-- enable referential integrity again 
EXEC sp_MSForEachTable 'ALTER TABLE ? WITH CHECK CHECK CONSTRAINT ALL' 
GO

GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [MLB].[Eligibility] WITH CHECK CHECK CONSTRAINT [FK_Eligilblity_Posiition];


GO
PRINT N'Update complete.';


GO
